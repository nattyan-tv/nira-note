# [NIRA Bot](../index)

# にらBOT ENDURED パッチノート
オリジナルのにらBOT、にらBOT#5034では、8/15ぐらいにアップデートを予定しています。  
まぁ予定は予定です...()

# ついにスラッシュコマンドに...！？
音楽再生を除くすべてのコマンドにおいて、スラッシュコマンドに対応しました！  
スラッシュコマンドは（一般的には）便利とされてるコマンドで、楽だと思います。  
ここだけの話、スラッシュコマンド限定の機能があったりなかったり...？

# 機能の追加
## メッセージロール・メッセージDM
特定のメッセージを送信したときに特定のロールを付与したり剥奪したり...DMでメッセージを送ったり...  
オートリプライ（n!er）のアップグレード版だと思ってください。  
`n!help mesrole`/`n!help mesdm`でご確認ください！

## メッセージ下部ピン留め
メッセージをチャンネルの下部に常時ピン留めします。  
新しいメッセージが送られたらどんどん下部にピン留めしていく感じです。  
`n!help pin`でご確認ください！

## メッセージ翻訳
メッセージをDeepL翻訳及びGoogle翻訳を使用して翻訳します。  
翻訳には二種類あり、__コマンドを使用した翻訳__ と、__チャンネルトピックを使用した翻訳__ があります。  
コマンドを使用した翻訳は、`n!translate`で翻訳します。  
または、翻訳したいメッセージを選択（長押し/右クリック）して、`アプリ`>`その他`>`メッセージの翻訳`を行うことで、そのメッセージが翻訳されます。  
チャンネルトピックを使用した翻訳は、チャンネルトピックに特定の文字列を入れることで、チャンネルに送信されたメッセージが全て自動で翻訳されます。  
`n!help translate`でご確認ください。  
なお、オリジナルのにらBOTでは、DeepL翻訳が使用できます。

## 招待リンクに名前を付ける
招待リンクに名前を付けることができます。  
これは、`n!ui`の、参加ユーザー情報表示機能にて、参加したユーザーがどの招待リンクを使用したか等に使われます。  
`n!help invite`でご確認ください。

## ユーザーコマンドの追加
ユーザーを選択して実行するコマンドに、`ユーザー情報表示`と`管理者権限チェック`を追加しました。  
選択したユーザーの情報を表示することができます。

## メッセージコマンドの追加
メッセージを選択して実行するコマンドに、`AutoSSのスタート`、`ロールパネルの編集`、`下部ピン留めする`、`投票パネルの編集`、`Embedコンテンツの取得`、`メッセージの翻訳`、`メッセージの読み上げ`を追加しました。  
`メッセージの翻訳`、`下部ピン留めする`については上記に記載した通りです。  
`ロールパネルの編集`、`投票パネルの編集`は下記にて説明させていただきます。

## 投票パネル/ロールパネルの編集機能
「あ！　ロールパネルにこのロールつけるの忘れた！」とか、「投票のこの選択肢消したいんだよねぇ...うにゅうにゅ...」って方向けの機能です。  
すでに作成された投票パネルやロールパネルを編集して、項目の追加及び削除を行うことができます。  
※投票パネルの編集は、新しいバージョンから提供される「rolepanel v2」の投票パネルでのみ使用できます。  
ロールパネルの編集は、特にバージョンの変更はございませんので、今までのロールパネルで、編集が行えます。

# 機能の改善
## 荒らし対策機能の改善
ちゃんと！使えるようにしました！  
今までの機能に加えて、現在付与されてるロールを全て剥奪する機能を追加しました。  
これによって、ちゃんと荒らし対策できるようになりました。  
多分...

## メッセージの読み上げ
TTS機能にて、VOICEVOXの新しいバージョンに対応させました。  
ずんだもんのささやきボイスが使えるよ...（ささやき）

## 投票パネルの改善
投票パネルにて、得票数を表示するようにしました。  
これによって、だいぶ見やすくなりました。  
なお、以前の投票パネルはアップデートの後は使用できなくなりますので、ご注意ください。  
なお、アップデートによって投票パネルやロールパネルを編集する機能が追加されました。上のほうでご確認ください。

## 参加者情報表示の高速化
参加者情報表示（n!ui）にて、ユーザーが参加してからメッセージが送信されるまでとても時間がかかっていましたが、データベースを変更したので、表示までの時間が短縮されました。  
これで多分ある程度は何とかなると思います（？）

## 通常反応の仕様変更
通常反応については、一部変更しました。  
DM及び、スレッドでの反応を無効化しました。  
もしかしたら今までも反応してなかったかもしれませんが、今回ちゃんと明示的に変更を加えました。

# バグ修正
- Welcomeメッセージを設定する際に、送信したい文にスペースが含まれていた場合に追加できない問題を修正しました。
- Welcomeメッセージを削除することができない問題を修正しました。
- サーバーステータスの自動表示機能で、場合によっては起動時しか実行されなかった問題を修正しました。
- サーバーステータスの自動表示機能で、場合によっては5分間隔ではなくそれ以上に短くなっていた問題を修正しました。
- リマインド機能で、場合によっては複数メッセージが送信されていた問題を修正しました。
- 追加反応の設定がほぼほぼできない問題を修正しました。
- 通常反応及び追加反応が動かない問題を修正しました。

# データの保存形式の変更
データの保存形式を、いままで`Google スプレッドシート`と`pickle保存`という、2種類の方法が混在してる地獄みたいな状態でしたが、今回ちゃんとデータ形式を全て変更しました。  
なににしよっかなーって考えた結果、データベースがいいと思ったんですよ。  
んでSQLがいいんだろうなーって思いましたが、（食わず嫌いで）あまりにもSQLが嫌いすぎたので、新しくデータベースとして`HTTP_db`を自作したので、それを使用することにしました。  
詳しくはこちらの[Qiitaの記事](https://qiita.com/nattyan_tv/items/4435be1e96e397944854)をご確認ください...  
多分そのうちSQLに変えようと思います...

# 最後に
巷では、商標登録だの、有料化だの...いろいろな話題がありますね。  
にらBOTは商標登録しません。（多分一般的に考えて無理）  
また、有料化はしません。なぜならその機構を作るほうが大変だろうし...

## Thanks
Thanks all contributors and users!
