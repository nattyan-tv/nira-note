# [NIRA Bot](../index)

# にらBOT Patch v3

## 仕様変更
にらBOTのデータを保存しているデータベースというものの仕様を変更して、データベースのデータを移行します。  
詳しくはDiscussionとかIssueとかを確認してください。

### 一部データが削除されます

今回のこのデータベースのデータ移行作業に伴い、一部のデータが削除されます。  
削除されるデータは下記のものです。

- にらBOTの反応設定（チャンネル/サーバーでBOTが反応するかどうかの設定）  
  理由: そもそもプログラムに問題があり、データが壊れていると思われるため。
- TTSのスピーカー設定（誰がどの声かの設定）  
  理由: そこまで重要ではないため。

### 一部機能がすぐに設定更新しなくなります

データベースへの接続の最適化を目的として、`er`/`ar`/`nr`などの、反応系の設定において、設定を更新してもすぐに反映されなくなります。  
コマンド等で設定を行った後、最大で30秒程経ってから反映されるようになります。

なお、データベースの移行に伴い、一部プログラムが正常に動作しない場合があります。  
私がよく「バグの温床」と言ってるプログラムは特にです。  
ちょっとづつログ収集して、直していきますのでよろしくお願いします。

## 新機能
新しくいくつかの機能を追加します。

- 定型文DM
- 天気検索
- スプラ3のマップ表示
- そこまで強くはない対話AIとのチャット機能
- オートリプライでのメンションなし設定
- ユーザー情報表示機能でロールも表示するように変更

### 定型文DM
定型文DM機能は、事前に定型文を設定しておくと、コマンドひとつで指定したユーザーに定型文を送信できます。  
サーバーのルールや、個別対応が必要なやつとかに便利かもしれません。

### 天気検索
地名や国名を入れて、天気を調べる機能です。  
[wttr.in](https://github.com/chubin/wttr.in)というサービスを利用しています。

`/weather`コマンドで使えます。

なお、個人情報の漏洩には十分にお気を付けください。

### スプラ3のマップ表示
> ベータ版の機能です！

スプラ3のマップを表示する機能です。  
現状では、レギュラーマッチのマップがコマンドで見れます。

`/splatoon stage`コマンドで使えます。

### そこまで強くはない対話AIとのチャット機能
`ChatGPT`の流行りがあまりにも凄くて、便乗でつけちゃいました。  
かといってChatGPTを使ってるわけじゃないです。  
株式会社リクルートが提供している、[A3RT Talk API](https://a3rt.recruit.co.jp/product/talkAPI/)を使用しています。

需要が限りなくないと思うので、そのうち気分で消すと思います。

`/talk`コマンドで使えます。

### オートリプライでのメンションなし設定
要望があった機能の一つとして、オートリプライにメンションをしない設定をすることが出来るようになりました。  
どういうことかって言うと、返信はするけどメンションはしない（ほら、メッセージに返信する時`@ON`とか`@OFF`とか選べるでしょ）というような設定です。  
モデレーターの方などがチャンネルに定型文を送る際などに便利かもしれません。

オートリプライの設定は、`n!er edit`/`/er edit`コマンドなどで行えます。  
権限に`サーバー管理`が必要になります。  
権限をお持ちでない方は、サーバーの管理者に要望してみてください。

### ユーザー情報表示機能でロールも表示するように変更
`n!d`とかで表示できる「ユーザー情報」において、そのサーバーのロールも表示するように変更しました。

### その他
もしかしたら、忘れてるだけで何かの機能を追加してるかもしれません。  
まぁなんかほどほどに使ってあげてください。

> 「あれ？　原神の機能は？」とか思った方がもしかしたらいるかもしれません。  
> 申し訳ないんですけど、まだロールアウト間に合わないです。  
> いろいろコードを書かないといけないもので...

## 不具合修正
いくつかの問題の修正と動作の安定性、利便性を向上させました。（雑概要）

下に覚えてる限りで修正したものを書いていきます。

- Steamサーバーステータス(`ss`)において、サーバー数が多い場合に表示が崩れる問題を暫定的修正しました。  
  なお、暫定的修正で、更にサーバー数が増えていくと表示されなくなる場合があります。
- Minecraftサーバーの登録一覧をDMに送信する際に、`アプリケーションが応答しませんでした`と表示される問題を修正しました。
- メッセージコマンド（`メッセージを右クリックして「アプリ」って表示されるやつ`）で、「その他」の項目が一切動作しない問題を修正しました。
- 一部の処理が実行されている間、BOTの動作が停止する問題を修正しました。
- 一部の機能において、設定が削除できない問題をある程度修正しました。
- TTS（読み上げ）機能において、読み上げが行われない問題をごま塩程度に改善しました。

また、サーバー機でスワップ容量を増やしたから、ちょっとは動作が安定するはず...（って言いながら落ちてんだけど）

アップデートに伴い、バグが増えると思いますが相変わらずのご愛嬌。バグないと楽しくないしね。

## おわりに
まずね、`renpy-sdk`のzipを`wget`するじゃん。  
んで`unzip`するじゃん。  
んで`cd renpy-sdk`ってするじゃん。  
サーバー落ちるじゃん。

なんで？？？？？？？？？？？？？？？？？？？？？

あ、どうも、一応Ren'PyのConteributeに参加したから名前がホームページに載ってる人です。  
Ren'Pyは悪くないから！！！ 同じPythonシリーズ仲良くしようぜ！！！！！ しらんけど！！！

というわけで、メモ書き程度のパッチノートは以上です。

Writer: @nattyan-tv
